<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <description>Scheduled flow, runs once per day at 23:45 for all Loyalty Member Tier records that have Manual Tier Immunity which will expire at the date the flow runs on. Flow removes Manual Tier Immunity from Loyalty Member Tier and Loyalty Program Member. Also, the flow resets the value of Manual Tier Immunity Expiration Date to blank.</description>
    <environments>Default</environments>
    <interviewLabel>Loyalty - Manual Tier Immunity Expiration {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Loyalty - Manual Tier Immunity Expiration</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <name>Update_Loyalty_Member_Tier</name>
        <label>Update Loyalty Member Tier</label>
        <locationX>567</locationX>
        <locationY>116</locationY>
        <connector>
            <targetReference>Update_Parent_Loyalty_Program_Member</targetReference>
        </connector>
        <inputAssignments>
            <field>Manual_Tier_Immunity_Expiration_Date__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Tier_Immunity_Reason__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Tier_Immunity__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Parent_Loyalty_Program_Member</name>
        <label>Update Parent Loyalty Program Member</label>
        <locationX>762</locationX>
        <locationY>116</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.LoyaltyMemberId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Manual_Tier_Immunity_Level__c</field>
        </inputAssignments>
        <object>LoyaltyProgramMember</object>
    </recordUpdates>
    <start>
        <locationX>84</locationX>
        <locationY>37</locationY>
        <connector>
            <targetReference>Update_Loyalty_Member_Tier</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Tier_Immunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Manual_Tier_Immunity_Expires_Today__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>LoyaltyMemberTier</object>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2023-11-09</startDate>
            <startTime>23:45:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
</Flow>
