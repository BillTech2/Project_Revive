<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Preference_Center</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Preference Center</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>function addJavascript(jsname,pos) {
var th = document.getElementsByTagName(pos)[0];
var s = document.createElement(&#39;script&#39;);
s.setAttribute(&#39;type&#39;,&#39;text/javascript&#39;);
s.setAttribute(&#39;src&#39;,jsname);
th.appendChild(s);
}

addJavascript(&#39;/support/console/45.0/integration.js&#39;,&#39;head&#39;);
addJavascript(&#39;/soap/ajax/45.0/connection.js&#39;,&#39;head&#39;);


var myTimer = 1;

function timeoutToOpen() {
myTimer++;
console.log(&#39;timer: &#39;,myTimer);
if (myTimer &gt; 20) {
return;
}

if ((typeof sforce) == &#39;undefined&#39;) {
setTimeout(timeoutToOpen, 100);
} else {
testOpenPrimaryTab();
}

}
function testOpenPrimaryTab() {


var domainQuery = &quot;Select Data__c From Preference_Center_Configuration__c where Name = &#39;DomainName&#39;&quot;;
var result = sforce.connection.query(domainQuery);
var records = result.getArray(&#39;records&#39;);
var domainName=records[0].Data__c;

if (!sforce.console.isInConsole()) {
window.open(domainName + &#39;?accId={!Account.Id}&#39;);
//window.open(&#39;/apex/PreferenceCenterMain?accId={!Account.Id}&#39;);
} else {
//Open a new primary tab with the salesforce.com home page in it
sforce.console.openPrimaryTab(null, domainName + &#39;?accId={!Account.Id}&#39;, true,
&#39;Preference center&#39;, openSuccess, &#39;salesforceTab&#39;);
}
}

var openSuccess = function openSuccess(result) {
//Report whether opening the new tab was successful
if (result.success == true) {
//alert(&#39;Primary tab successfully opened&#39;);
console.log(&#39;Primary tab successfully opened&#39;);
} else {
alert(&#39;Primary tab cannot be opened&#39;);
}
};

timeoutToOpen();</url>
</WebLink>
